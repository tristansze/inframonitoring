groups:
  - name: node_alerts
    rules:
      # Fires when a node exporter is unreachable for 30 seconds
      - alert: NodeDown
        expr: up{job="nodes"} == 0
        for: 30s
        labels:
          severity: critical
        annotations:
          summary: "Node {{ $labels.instance }} is down"
          description: "{{ $labels.instance }} has been unreachable for 30 seconds."

      # Fires when CPU usage exceeds 80% for 2 minutes
      - alert: HighCpuUsage
        expr: 100 - (avg by(instance) (rate(node_cpu_seconds_total{mode="idle"}[2m])) * 100) > 80
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "High CPU on {{ $labels.instance }}"
          description: "CPU usage is above 80% for 2 minutes (current: {{ $value | printf \"%.1f\" }}%)."

      # Fires when available memory drops below 20%
      - alert: LowMemory
        expr: (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes) * 100 < 20
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "Low memory on {{ $labels.instance }}"
          description: "Available memory is below 20% (current: {{ $value | printf \"%.1f\" }}%)."

      # Fires when disk usage exceeds 85%
      - alert: DiskSpaceLow
        expr: (node_filesystem_avail_bytes{mountpoint="/"} / node_filesystem_size_bytes{mountpoint="/"}) * 100 < 15
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Disk space low on {{ $labels.instance }}"
          description: "Less than 15% disk space remaining (current: {{ $value | printf \"%.1f\" }}% free)."
